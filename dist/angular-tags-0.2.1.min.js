!function(){"use strict";try{angular.module("decipher.tags.templates")}catch(a){angular.module("decipher.tags.templates",[])}var b=angular.module("decipher.tags",["ui.bootstrap.typeahead","decipher.tags.templates"]),c={delimiter:",",classes:{},templateUrl:"tags.html",tagTemplateUrl:"tag.html"},d=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/,e={enter:13,esc:27,backspace:8},f=[e.enter],g=[e.backspace],h=[e.esc],i=0;b.constant("decipherTagsOptions",{}),b.controller("TagsCtrl",["$scope","$timeout",function(a,b){var c=[];a.getClasses=function(b){var c={};return b===a.toggles.selectedTag&&(c.selected=!0),angular.forEach(a.options.classes,function(a,d){b.group===d&&(c[a]=!0)}),c},a.add=function(d){var e,f,g=function(b){a.tags.push(b),delete a.inputTag,a.$emit("decipher.tags.added",{tag:b,$id:a.$id})},h=function(){a.$emit("decipher.tags.addfailed",{tag:d,$id:a.$id})};for(f=a.tags.length;f--;)if(a.tags[f].name===d.name)return h(),!1;return e=a.srcTags.indexOf(d),e>=0?(b(function(){a.srcTags.splice(e,1)}),c.push(d),g(d),!0):a.options.addable?(g(d),!0):(h(),!1)},a.selectArea=function(){a.toggles.inputActive=!0},a.remove=function(b){var d;a.tags.splice(a.tags.indexOf(b),1),(d=c.indexOf(b)>=0)&&(c.splice(d,1),a.srcTags.push(b)),delete a.toggles.selectedTag,a.$emit("decipher.tags.removed",{tag:b,$id:a.$id})}}]),b.directive("decipherTagsInput",["$timeout","$filter","$rootScope",function(a,b,c){return{restrict:"C",require:"ngModel",link:function(d,e,i,j){var k=new RegExp("^"+d.options.delimiter+"+$"),l=function(){j.$setViewValue(""),j.$render()},m=function(a){if(a){if(a.match(k))return l(),void 0;d.add({name:a})&&l()}},n=function(a){var b;for(b=0;b<a.length;b++)m(a[b])},o=function(){var a;d.toggles.selectedTag?(d.remove(d.toggles.selectedTag),delete d.toggles.selectedTag):j.$viewValue||(a=b("orderBy")(d.tags,d.orderBy),d.toggles.selectedTag=a[a.length-1])};e.bind("focus",function(){c.$$phase?delete d.toggles.selectedTag:d.$apply(function(){delete d.toggles.selectedTag})}),e.bind("keypress",function(a){d.$apply(function(){d.options.delimiter.charCodeAt()===a.which&&m(j.$viewValue)})}),e.bind("keypress",function(a){d.$apply(function(){f.indexOf(a.which)>=0?m(j.$viewValue):h.indexOf(a.which)>=0?(l(),d.toggles.inputActive=!1):g.indexOf(a.which)>=0?o():(delete d.toggles.selectedTag,d.$emit("decipher.tags.keyup",{value:j.$viewValue,$id:d.$id}))})}),d.$watch("toggles.inputActive",function(b){b&&a(function(){e[0].focus()})}),j.$parsers.unshift(function(a){var b=a.split(d.options.delimiter);return b.length>1&&n(b),a.match(k)?(e.val(""),void 0):a}),j.$formatters.push(function(a){return a&&a.value?(e.val(""),void 0):a})}}}]),b.directive("tags",["$document","$timeout","$parse","decipherTagsOptions",function(a,b,e,f){return{controller:"TagsCtrl",restrict:"E",template:'<ng-include data-src="options.templateUrl"></ng-include>',scope:{model:"="},link:function(a,b,g){var h,j,k,l,m,n,o,p,q,r=!1,s=!1,t=angular.copy(c),u=angular.copy(f),v=function(a){var b=a.match(d);if(!b)throw new Error("Expected src specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+a+"'.");return{itemName:b[3],source:e(b[4]),viewMapper:e(b[2]||b[1]),modelMapper:e(b[1])}},w=function(b){var c=[],d=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")};if(!angular.isUndefined(b)){if(angular.isString(b))c=b.split(a.options.delimiter).map(function(a){return{name:d(a.trim())}});else if(angular.isArray(b))c=b.map(function(a){return angular.isString(a)?{name:d(a.trim())}:(a.name&&(a.name=d(a.name.trim())),a)});else if(angular.isDefined(b))throw"list of tags must be an array or delimited string";return c}};if(a.options=angular.extend(t,angular.extend(u,a.$eval(g.options))),a.orderBy=a.options.orderBy,a.toggles={inputActive:!1},a.$watch("tags",function(b,c){b!==c&&((s||r)&&(b=b.map(function(a){return a.name}),r&&(b=b.join(a.options.delimiter))),a.model=b)},!0),a.$on("decipher.tags.sort",function(b,c){a.orderBy=c}),q=a.model,angular.isString(q))r=!0;else if(angular.isArray(q))for(s=!0,m=q.length;m--;)if(!angular.isString(q[m])){s=!1;break}if(a.tags=w(a.model),a.srcTags=[],g.src){if(a.options.addable=a.options.addable||!1,h=v(g.src),j=h.source(a.$parent),o={},angular.isDefined(j))for(m=0;m<j.length;m++)o[h.itemName]=j[m],p={},p.value=h.modelMapper(a.$parent,o),p.value.group||p.value.value?(k=p.value.group,l=p.value.value):l=p.value,n={},n=angular.isObject(p.value)?angular.extend(p.value,{name:h.viewMapper(a.$parent,o),value:l,group:k}):{name:h.viewMapper(a.$parent,o),value:l,group:k},a.srcTags.push(n)}else a.options.addable=!0;a.$id=++i,a.$emit("decipher.tags.initialized",{$id:a.$id,model:a.model})}}}])}();
//# sourceMappingURL=dist/angular-tags-0.2.1.map.js